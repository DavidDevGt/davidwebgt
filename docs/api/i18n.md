# I18n Module API

## Overview

The I18n module provides internationalization functionality for the David Vargas Portfolio. It handles translation loading, language detection, DOM translation, and language switching with LocalStorage persistence.

## Class: I18n

Main internationalization class that manages translations and language state.

### Constructor

```javascript
const i18n = new I18n()
```

**Description**: Creates a new I18n instance with automatic language detection.

**Properties**:
- `currentLang` (string): Currently active language code
- `translations` (object): Loaded translation data
- `isLoaded` (boolean): Whether translations are loaded

### Methods

#### detectLanguage()

```javascript
string detectLanguage()
```

**Description**: Detects the user's preferred language from LocalStorage or browser settings.

**Returns**: Language code ('es' or 'en')

**Algorithm**:
1. Check LocalStorage for saved preference
2. If not found, check `navigator.language`
3. Validate against supported languages
4. Default to 'es' if no valid language found

**Example**:
```javascript
const lang = i18n.detectLanguage(); // 'es' or 'en'
```

#### isValidLanguage(lang)

```javascript
boolean isValidLanguage(string lang)
```

**Description**: Validates if a language code is supported.

**Parameters**:
- `lang` (string): Language code to validate

**Returns**: `true` if language is supported, `false` otherwise

**Example**:
```javascript
i18n.isValidLanguage('es'); // true
i18n.isValidLanguage('fr'); // false
```

#### loadTranslations()

```javascript
Promise<boolean> loadTranslations()
```

**Description**: Loads translation files for the current language from JSON files.

**Returns**: Promise resolving to `true` if successful, `false` otherwise

**Behavior**:
- Fetches `assets/i18n/${currentLang}.json`
- Parses JSON response
- Sets `isLoaded` to `true` on success
- Falls back to Spanish if current language fails
- Logs errors to console

**Example**:
```javascript
const success = await i18n.loadTranslations();
if (success) {
  console.log('Translations loaded');
}
```

**Error Handling**:
- Network errors: Logged and fallback attempted
- JSON parsing errors: Logged and fallback attempted
- File not found: Falls back to Spanish

#### t(key, fallback)

```javascript
string t(string key, string fallback = '')
```

**Description**: Translates a key using loaded translations with dot notation support.

**Parameters**:
- `key` (string): Translation key (supports dot notation like 'nav.home')
- `fallback` (string, optional): Fallback text if translation not found

**Returns**: Translated string or fallback

**Algorithm**:
1. Split key by dots to navigate nested object
2. Traverse translations object
3. Return found translation or fallback
4. Log warning for missing keys

**Examples**:
```javascript
i18n.t('nav.home'); // 'Inicio' (in Spanish)
i18n.t('nav.missing', 'Default'); // 'Default'
i18n.t('user.profile.name'); // Nested key access
```

#### translatePage()

```javascript
void translatePage()
```

**Description**: Translates all DOM elements with `data-i18n` attributes.

**Behavior**:
- Finds all elements with `data-i18n` attribute
- Translates text content, placeholders, alt text
- Handles HTML content for translations with markup
- Updates title and aria-label attributes

**Supported Attributes**:
- `data-i18n`: Main translation key
- `data-i18n-title`: Title attribute translation
- `data-i18n-aria-label`: Aria-label translation

**Element Type Handling**:
- **Default**: Sets `textContent`
- **HTML Content**: Uses `innerHTML` if translation contains `<`
- **Inputs**: Sets `placeholder` attribute
- **Images**: Sets `alt` attribute

**Example HTML**:
```html
<span data-i18n="nav.home"></span>
<input data-i18n="search.placeholder" type="text">
<img data-i18n="logo.alt" src="logo.png" alt="">
```

#### changeLanguage(lang)

```javascript
Promise<boolean> changeLanguage(string lang)
```

**Description**: Changes the current language and updates the entire application.

**Parameters**:
- `lang` (string): New language code

**Returns**: Promise resolving to `true` if successful

**Behavior**:
1. Validates language code
2. Updates `currentLang`
3. Saves to LocalStorage
4. Updates `document.documentElement.lang`
5. Loads new translations
6. Translates page content
7. Dispatches `languageChanged` event
8. Updates UI components

**Events Dispatched**:
- `languageChanged`: With language detail

**Example**:
```javascript
await i18n.changeLanguage('en');
```

#### getCurrentLanguage()

```javascript
string getCurrentLanguage()
```

**Description**: Returns the currently active language code.

**Returns**: Current language code ('es' or 'en')

**Example**:
```javascript
const current = i18n.getCurrentLanguage(); // 'es'
```

#### getAvailableLanguages()

```javascript
Array<LanguageInfo> getAvailableLanguages()
```

**Description**: Returns information about all supported languages.

**Returns**: Array of language objects with code, name, and flag

**Type Definition**:
```javascript
interface LanguageInfo {
  code: string;  // 'es' or 'en'
  name: string;  // 'EspaÃ±ol' or 'English'
  flag: string;  // 'ðŸ‡ªðŸ‡¸' or 'ðŸ‡ºðŸ‡¸'
}
```

**Example**:
```javascript
const languages = i18n.getAvailableLanguages();
// [{ code: 'es', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' }, ...]
```

#### init()

```javascript
Promise<boolean> init()
```

**Description**: Initializes the i18n system by loading translations and translating the page.

**Returns**: Promise resolving to `true` if successful

**Behavior**:
1. Loads translations for detected language
2. Translates page content
3. Sets up language button
4. Updates options menu
5. Updates topbar

**Example**:
```javascript
await i18n.init();
```

## Global Functions

### toggleLanguageMenu()

```javascript
void toggleLanguageMenu()
```

**Description**: Toggles visibility of the language selection menu.

**Behavior**: Toggles 'hidden' class on language menu elements.

### toggleLanguage()

```javascript
void toggleLanguage()
```

**Description**: Switches to the next available language in sequence.

**Behavior**: Cycles es â†’ en â†’ es.

### changeLanguage(lang)

```javascript
void changeLanguage(string lang)
```

**Description**: Changes language using the global i18n instance.

**Parameters**:
- `lang` (string): Language code

**Behavior**: Calls `i18n.changeLanguage()` and updates UI.

### updateLanguageButton()

```javascript
void updateLanguageButton()
```

**Description**: Updates the language button with current language information.

**Behavior**: Updates flag and text in language button elements.

### closeLanguageMenu()

```javascript
void closeLanguageMenu()
```

**Description**: Hides the language selection menu.

### updateTopbar()

```javascript
void updateTopbar()
```

**Description**: Updates the topbar with current language translations.

### insertTopbar()

```javascript
void insertTopbar()
```

**Description**: Inserts the topbar into the DOM with proper translations.

## Events

### languageChanged

**Description**: Fired when the language is successfully changed.

**Detail Object**:
```javascript
{
  language: string  // New language code
}
```

**Example Listener**:
```javascript
window.addEventListener('languageChanged', (event) => {
  console.log('Language changed to:', event.detail.language);
});
```

### i18nReady

**Description**: Fired when the i18n system is fully initialized.

**Example Listener**:
```javascript
window.addEventListener('i18nReady', () => {
  console.log('i18n system ready');
});
```

## Error Handling

### Translation Loading Failures
- Logged to console with error details
- Automatic fallback to Spanish
- Graceful degradation with fallback text

### Invalid Language Codes
- Validation prevents unsupported languages
- Logged warnings for invalid attempts
- No state corruption from invalid inputs

### DOM Translation Errors
- Missing translation keys logged as warnings
- Fallback text prevents empty content
- Continues processing other elements

## Performance Characteristics

### Memory Usage
- Translation objects cached in memory
- Minimal memory footprint (~50KB for both languages)
- No memory leaks from event listeners

### Loading Performance
- Initial load: ~10KB JSON files
- Cached after first load
- No blocking operations

### Runtime Performance
- Translation lookup: O(1) average case
- DOM translation: O(n) where n = elements with data-i18n
- Language switching: ~100ms for full page update

## Browser Compatibility

### Supported Browsers
- **Fetch API**: Required for translation loading
- **LocalStorage**: Required for language persistence
- **ES6 Features**: Arrow functions, template literals, promises

### Fallback Behavior
- Older browsers: Progressive enhancement
- No JavaScript: Core content still accessible
- Failed loads: Fallback to Spanish/defaults

## Testing

### Unit Tests
- Translation key lookup accuracy
- Language validation logic
- DOM manipulation correctness
- Event dispatching verification

### Integration Tests
- Full language switching workflow
- Translation loading and caching
- UI component updates
- LocalStorage persistence

### Manual Tests
- Cross-browser compatibility
- Keyboard navigation
- Screen reader accessibility
- Mobile responsiveness

## Usage Examples

### Basic Translation
```javascript
// HTML
<span data-i18n="nav.home"></span>

// JavaScript
i18n.t('nav.home'); // Returns translated text
```

### Language Switching
```javascript
// Change to English
await i18n.changeLanguage('en');

// Listen for changes
window.addEventListener('languageChanged', (e) => {
  console.log('Switched to:', e.detail.language);
});
```

### Initialization
```javascript
// Initialize i18n system
await i18n.init();

// Or use global functions
changeLanguage('en');
```

## Dependencies

### External
- None (uses browser APIs only)

### Internal
- LocalStorage for persistence
- Fetch API for loading translations
- DOM API for content translation

## Future Enhancements

### Planned Features
- Additional language support
- Dynamic translation loading
- Translation key validation
- Real-time translation updates

### Potential Improvements
- Translation caching strategies
- Bundle size optimization
- Performance monitoring
- A/B testing for translations